// Generated by CoffeeScript 1.9.1
var checkDocType, feed, fs;

fs = require('fs');

feed = require('../lib/feed');

checkDocType = require('../lib/token').checkDocType;

module.exports.deleteFiles = function(files) {
  var file, key, results;
  if ((files != null) && Object.keys(files).length > 0) {
    results = [];
    for (key in files) {
      file = files[key];
      results.push(fs.unlinkSync(file.path));
    }
    return results;
  }
};

module.exports.checkPermissions = function(req, permission, next) {
  return checkDocType(req.header('authorization'), permission, function(err, appName, isAuthorized) {
    if (!appName) {
      err = new Error("Application is not authenticated");
      err.status = 401;
      return next(err);
    } else if (!isAuthorized) {
      err = new Error("Application is not authorized");
      err.status = 403;
      return next(err);
    } else {
      feed.publish('usage.application', appName);
      req.appName = appName;
      return next();
    }
  });
};
